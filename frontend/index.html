<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ«ãƒ¼ãƒˆæ¤œç´¢ - GCP Routes API</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« -->
        <aside class="side-panel">
            <header class="panel-header">
                <h1>ğŸš— ãƒ«ãƒ¼ãƒˆæ¤œç´¢</h1>
                <p class="subtitle">è»Šã§ã®ç§»å‹•ãƒ«ãƒ¼ãƒˆã¨æ‰€è¦æ™‚é–“ã‚’æ¤œç´¢</p>
            </header>

            <form id="route-form" class="route-form">
                <div class="form-group">
                    <label for="origin">
                        <span class="marker origin-marker">A</span>
                        å‡ºç™ºåœ°
                    </label>
                    <input 
                        type="text" 
                        id="origin" 
                        name="origin" 
                        placeholder="ä¾‹: æ±äº¬é§…"
                        required
                        autocomplete="off"
                    >
                </div>

                <div class="form-group">
                    <label for="destination">
                        <span class="marker destination-marker">B</span>
                        ç›®çš„åœ°
                    </label>
                    <input 
                        type="text" 
                        id="destination" 
                        name="destination" 
                        placeholder="ä¾‹: æ¨ªæµœé§…"
                        required
                        autocomplete="off"
                    >
                </div>

                <button type="submit" id="search-btn" class="search-btn">
                    <span class="btn-text">ãƒ«ãƒ¼ãƒˆã‚’æ¤œç´¢</span>
                    <span class="btn-loading" hidden>
                        <span class="spinner"></span>
                        æ¤œç´¢ä¸­...
                    </span>
                </button>
            </form>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="result-panel" class="result-panel" hidden>
                <h2>æ¤œç´¢çµæœ</h2>
                <div class="result-cards">
                    <div class="result-card">
                        <div class="result-icon">ğŸ•</div>
                        <div class="result-content">
                            <span class="result-label">æ‰€è¦æ™‚é–“</span>
                            <span id="duration" class="result-value">--</span>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="result-icon">ğŸ“</div>
                        <div class="result-content">
                            <span class="result-label">è·é›¢</span>
                            <span id="distance" class="result-value">--</span>
                        </div>
                    </div>
                </div>
                <div class="route-details">
                    <div class="route-point">
                        <span class="marker origin-marker">A</span>
                        <span id="origin-address" class="address">--</span>
                    </div>
                    <div class="route-line"></div>
                    <div class="route-point">
                        <span class="marker destination-marker">B</span>
                        <span id="destination-address" class="address">--</span>
                    </div>
                </div>
            </div>

            <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="error-panel" class="error-panel" hidden>
                <div class="error-content">
                    <span class="error-icon">âš ï¸</span>
                    <span id="error-message">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</span>
                </div>
            </div>

            <footer class="panel-footer">
                <p>Powered by Google Maps Platform</p>
            </footer>
        </aside>

        <!-- åœ°å›³ã‚¨ãƒªã‚¢ -->
        <main class="map-container">
            <div id="map"></div>
        </main>
    </div>

    <!-- Google Maps JavaScript API -->
    <!-- æ³¨æ„: YOUR_MAPS_API_KEY ã‚’å®Ÿéš›ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ -->
    <script>
        window.BACKEND_URL = 'http://localhost:8000';

        // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—ã—ã¦Google Mapsã‚’èª­ã¿è¾¼ã‚€
        async function loadGoogleMaps() {
            try {
                const response = await fetch(`${window.BACKEND_URL}/api/config`);
                if (!response.ok) throw new Error('Failed to load config');
                const data = await response.json();
                
                if (!data.mapsApiKey) throw new Error('API Key is missing');

                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${data.mapsApiKey}&language=ja&region=JP&libraries=geometry&callback=initMap`;
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
            } catch (error) {
                console.error('Failed to load Google Maps API info:', error);
                const mapEl = document.getElementById('map');
                if (mapEl) {
                    mapEl.innerHTML = '<div style="padding: 20px; color: red;">åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
                }
            }
        }
        
        // app.jsã®èª­ã¿è¾¼ã¿ã‚’å¾…ã£ã¦ã‹ã‚‰å®Ÿè¡Œï¼ˆinitMapã®å­˜åœ¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ï¼‰
        window.addEventListener('load', loadGoogleMaps);
    </script>
    <script src="js/app.js"></script>
</body>
</html>
